import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Docker

## 前言


- 购买捐赠版可以上 https://www.zfile.vip/pricing 查看功能介绍并购买.
- ZFile Pro 支持从 4.x 兼容升级，<span class="text-red-500">不支持从 3.x 或更早的版本带数据升级</span>.
- 部署过程有问题，联系 qq: 873019219.
- 镜像地址为：https://hub.docker.com/r/zhaojun1998/zfile-pro

<span class="font-bold">tips：如从开源版 4.x 版本升级到的捐赠版，想要保留之前的数据，需将下文中的 `/root/zfile-pro/db:/root/.zfile-v4/db` 中的左侧 `/root/zfile-pro/db` 修改为 `/root/zfile/db`，否则会创建新的数据库.</span>

## docker

:::tip
以下命令倒数第二行 `-v /root/zfile-pro/file:/data/file \` 为映射宿主机文件夹 `/root/zfile-pro/file` 到容器内的 `/data/file` 文件夹，这样你就可以在容器内，本地存储里通过 `/data/file` 访问宿主机的 `/root/zfile-pro/file` 目录了。 这一行按照自己的需求修改，如果不需要映射本地存储，则可以删除这一行
:::

```bash showLineNumbers {5}
docker run -d --name=zfile-pro --restart=always \
    -p 8080:8080 \
    -v /root/zfile-pro/db:/root/.zfile-v4/db \
    -v /root/zfile-pro/logs:/root/.zfile-v4/logs \
    -v /root/zfile-pro/file:/data/file \
    zhaojun1998/zfile-pro
```

:::tip

如需映射配置文件则需要先在宿主机下载配置文件，然后映射到容器内:
下载 [`application.properties`](https://c.jun6.net/ZFILE-PRO/application.properties) 文件到 `/root` 目录下, 此目录可自行更改, 命令如:

:::

```bash showLineNumbers
curl -o /root/application.properties https://c.jun6.net/ZFILE-PRO/application.properties
```

**然后增加一个 -v 参数(见下面倒数第二行)，将此源文件映射到容器内（如修改宿主机的 application.properties 为其他路径, 则下面命令也要一起修改）, 如:**

```bash showLineNumbers {6}
docker run -d --name=zfile-pro --restart=always \
    -p 8080:8080 \
    -v /root/zfile-pro/db:/root/.zfile-v4/db \
    -v /root/zfile-pro/logs:/root/.zfile-v4/logs \
    -v /root/zfile-pro/file:/data/file \
    -v /root/application.properties:/root/application.properties \
    zhaojun1998/zfile-pro
```


## docker compose

:::tip
以下命令倒数第二行 `-v /root/zfile-pro/file:/data/file \` 为映射宿主机文件夹 `/root/zfile-pro/file` 到容器内的 `/data/file` 文件夹，这样你就可以在容器内，本地存储里通过 `/data/file` 访问宿主机的 `/root/zfile-pro/file` 目录了。 这一行按照自己的需求修改，如果不需要映射本地存储，则可以删除这一行
:::

```yml showLineNumbers {11}
version: '3.3'
services:
    zfile:
        container_name: zfile-pro
        restart: always
        ports:
            - '8080:8080'
        volumes:
            - '/root/zfile-pro/db:/root/.zfile-v4/db'
            - '/root/zfile-pro/logs:/root/.zfile-v4/logs'
            - '/root/zfile-pro/file:/data/file'
        image: zhaojun1998/zfile-pro
```

:::tip

如需映射配置文件则需要先在宿主机下载配置文件，然后映射到容器内:
下载 [`application.properties`](https://c.jun6.net/ZFILE-PRO/application.properties) 文件到 `/root` 目录下, 此目录可自行更改, 命令如:

:::

```bash showLineNumbers
curl -o /root/application.properties https://c.jun6.net/ZFILE-PRO/application.properties
```

**然后增加一个 -v 参数(见下面倒数第二行)，将此源文件映射到容器内（如修改宿主机的 application.properties 为其他路径, 则下面命令也要一起修改）, 如:**

```yml showLineNumbers {12}
version: '3.3'
services:
    zfile:
        container_name: zfile-pro
        restart: always
        ports:
            - '8080:8080'
        volumes:
            - '/root/zfile-pro/db:/root/.zfile-v4/db'
            - '/root/zfile-pro/logs:/root/.zfile-v4/logs'
            - '/root/zfile-pro/file:/data/file'
            - '/root/application.properties:/root/application.properties'
        image: zhaojun1998/zfile-pro
```

-----


## 更新

### 手动更新

> 单次手动更新名称为 `zfile-pro` 的容器

```bash showLineNumbers
docker run --rm \
    -v /var/run/docker.sock:/var/run/docker.sock \
    containrrr/watchtower \
    --cleanup \
    --run-once \
    zfile-pro
```

### 自动更新

> 每 3600 秒 （1小时）自动检测更新名称为 `zfile-pro` 的容器

```bash showLineNumbers
docker run -d \
    --name watchtower \
    --restart always \
    -v /var/run/docker.sock:/var/run/docker.sock \
    containrrr/watchtower \
    --cleanup \
    zfile-pro \
    -i 3600
```