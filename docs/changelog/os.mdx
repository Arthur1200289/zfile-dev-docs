# 开源社区版更新日志

## 4.0.10

### 优化

- 未填写备案信息时, footer 不显示.
- 优化 OneDrive/SharePoint 获取 token 体验，增加信息显示，并优化页面效果。 #422

### BUG
- 修复 SharePoint 世纪互联自定义 api 失败的 bug #422
- 修复 OneDrive/SharePoint 自定义 api 时 clientSecret 包含特殊字符时异常的 bug #422
- 修复兼容读取 readme.md 模式仅启动后首次设置有效的 bug #414

### 捐赠版
- 打包下载增加 loading
- 打包下载时，其中一个文件错误，则取消打包并提示错误文件.
- 批量下载和打包下载授权功能，授予管理员/匿名用户是否可用
- 捐赠版与开源版功能区别介绍：https://www.zfile.vip/pricing

<div className={'divider'}></div>

## 4.0.9

### 新功能

- 增加目录文档兼容模式，如启用该功能，则忽略规则模式，而是读取目录下 `readme.md` 文件，并显示在文件列表下方显示 #414
- 增加最大同时上传数限制
- 新增同时上传文件数量限制, 新增上传失败重试功能，新增删除等待中和已完成任务功能

### 优化

- 完善 `OneDrive` `SharePoint` 自定义 `clientId` 、`clientSecret`、`redirectUri` 功能体验.
- 优化后台存储源列表页面, 更易于操作
- 优化上传页面样式，更加美观.
- 因浏览器特性兼容性，批量下载或打包下载时判断当前浏览器，提示推荐使用谷歌浏览器。
- 优化自定义 js 功能，支持写 `<script></script>` 标签也可不写，解析时会自动兼容.
- 优化代码，修改配置信息默认值，并使 `zfile.config.json` 可配置前台设置默认值，如移动端默认画廊列数、画廊列间距、行间距等功能
- 优化画廊模式列间距功能, 避免大于 1 列且设置了列间距的情况下, 最后一列的右侧也会显示空白间距.  #415
- 当未上传完成时，增加 `badge` 显示未上传完成数量.
- 上传需要服务器中转的文件时，如 ftp、sftp、webdav 时提示服务器中转中.
- 浏览器控制台增加浏览器信息输出, 便于问题发现和排查
- 增加文件页文字宽度和粗度, 易于浏览
- 完善存储源别名填写时对系统默认关键字的检测, 如为系统关键词, 则不允许设置为存储源别名 #417
- 优化后台日志下载功能，增加 loading, 防止日志文件过大时导致看起来没反应的问题。

### BUG

- 修复批量删除直链或直链下载日志数量过多时, 无法正常删除的问题。
- 修复右键菜单点击空白处失败的 bug
- 修复默认打开画廊模式失败的 BUG.
- 修复右键菜单在错误的地方（如 dialog）显示的 bug

### 捐赠版
- **ZFile Pro 特有功能** 增加打包下载功能（仅兼容谷歌浏览器）
- 捐赠版与开源版功能区别介绍：https://www.zfile.vip/pricing

<div className={'divider'}></div>

## 4.0.8

### 新功能

- PDF 预览功能，支持按 `+` `-` 放大缩小，支持按 `←` `→` 切换页码（非显示全部页码状态下）
- 支持右键文件区空白处（非 header 和 footer 部分）新建文件夹、上传文件、上传文件夹
- 右键菜单支持刷新按钮

### 优化

- 完善 OneDrive SharePoint 反代域名参数的描述信息
- 统一本地存储、sftp、ftp、webdav 下载文件 contentType 为 application/octet-stream, 避免浏览器自动进行默认预览动作
- 完善删除文件、文件夹操作体验，区分删除的是一个还是多个。区分当前存储源是否支持删除非空文件夹
- 完善存储源添加时校验，如果 zfile 站点是 https 的，则提示不允许添加 http 协议的加速域名.
- 重构部分代码, 优化组件间的引用关系
- 修复拖拽上传和粘贴上传失效的 bug
- 优化移动端视频弹窗、文本弹窗、图片预览的兼容性问题
- 优化移动端视频播放器切换上一个下一个逻辑
- 优化 minio 提示信息

### BUG

- 修复 IOS 浏览器下画廊模式无法点击预览的 BUG
- 修复 Safari 浏览器某些文件类型无法正常下载的 BUG
- 修复 m3u8 无法正常播放的 BUG
- 修复兼容 h5ai_dplayer 时，如果切片目录隐藏，导致无法正常加载的 BUG
- 修复获取 m3u8 直链后系统报错的 bug.
- 修复默认打开画廊模式失败的 BUG.
- 修改后台密码保存一直转圈

<div className={'divider'}></div>

## 4.0.7

### 新功能
- 兼容 h5ai_dplayer https://github.com/Pearlulu/h5ai_dplayer ：如同目录下有 __{video_name}__ 则取 __{video_name}__/video.m3u8

### 优化
- 优化 S3 协议自动配置跨域逻辑，改为不覆盖原有配置。且增加 GET 跨域，对于在线预览文本、视频场景提供跨域支持.
- 优化图片预览使用体验，默认预览图片支持左右切换
- 画廊模式重新支持懒加载
- 移动端适配：优化文件页移动端布局，改为右上角点击显示所有功能
- 移动端适配：优化登陆和初始化页面移动端体验.
- 移动端适配：优化移动端消息提示和弹窗确认/弹窗输入框体验
- 移动端适配：优化移动端布局，管理后台表单元素支持换行.
- 移动端适配：优化移动端布局，移动端所有 dialog 弹窗宽度设置为 90%
- 移动端适配：优化后台管理移动端布局，下级后弹出所有功能菜单
- 移动端适配：优化管理后台 header 部分布局, 兼容移动端
- 代码优化，解除未来 jdk 版本对过期内容的引用

### BUG
- 修复画廊模式下点击无法预览的 BUG
- 修复文件列表某些情况最后一个文件会被挡住的 bug, 且会有两个滚动条，影响使用体验  #390   #393
- 修复 minio 设置跨域上传报错的 bug
- 更新 pom 依赖，去除无用依赖，升级有漏洞的依赖，划分相关的依赖

<div className={'divider'}></div>

## 4.0.6

### 新功能
- 独立直链和短链功能，短链不再依赖直链，可单独启用

### 优化
- 修复本地存储文件路径描述，对于 docker 环境更容易理解。
- 优化使用体验，移动端画廊模式默认为 1 列
- 优化视频、文本、文档等异步组件首次加载卡顿问题, 增加骨架屏.
- 优化移动端视频弹窗宽度

### BUG
- 修复腾讯云 cos 对象存储，无法自动加载账号下的所有存储器列表的 bug
- 修复长图片被拉伸的 bug
- 修复调用播放器 potplayer 时，链接中包含中文导致无法播放的 bug.
- 修复部分情况 ctrl + v 控制台报错的 bug
- 暂时关闭图片懒加载, 待完美解决后再次开放.

<div className={'divider'}></div>

## 4.0.5

### 新功能
- 支持在前台设置画廊模式是否点击放大预览图片
- 支持设置是否显示回到顶部按钮

### 优化
- 上传框，区分上传文件还是文件夹，给予提示
- 新增存储源默认勾选打开允许管理员文件操作
- 优化样式，修正 dialog 标题错位，修正移动端目录为空时，页面没有居中的问题
- 修改后台密码文件夹提示信息
- 修复全局公告和文档开关无效的 bug

### BUG
- 修复 Backspace 快捷键无法返回上级目录的  BUG
- 修复本地存储，文件重命名，前后名称一致时，会无限创建子目录的 bug
- 修复 4.0.4 版本更新导致的新增存储源错误的 bug, 其他版本不影响

<div className={'divider'}></div>

## 4.0.4

### 优化
- 修改密码文件夹输入时为密文
- 优化密码文件夹取消设置，支持点击取消回到上级目录

### BUG
- 优化视频播放器在移动端上一个下一个视频按钮未显示的 BUG.
- 修复后台当前版本号及最新版本号未显示 BUG
- 修复骨架屏数量异常的 BUG.
- 修复首页未显示标题的 BUG
- 修复启用匿名操作失败的 BUG

<div className={'divider'}></div>

## 4.0.3

### 新功能
- 画廊模式支持懒加载，再也不怕海量图片了
- 支持文件列表居中显示

### 优化
- 优化选择 S3 存储桶列表时的体验, 支持前缀搜索
- 优化视频播放器页面使用体验, 增加上一个，下一个按钮，优化移动端外部按钮的布局
- 再次优化列表访问性能，丝般顺滑
- 改善用户体验，非存储源根目录下密码框不允许取消，其他情况允许关闭密码框，并回到上级目录
- 增加对自定义 css js 的异常处理

### BUG
- 修复 url 路径中带 . 访问 404 的 bug
- 修复目录文档无论如何配置仅在首页显示的 bug.
- 修复 s3 存储类型不开启私有空间时，文件路径或文件名包含中文无法直链下载的 bug
- 修复本地存储、FTP、SFTP、WebDav 未启用私有空间，仍然校验私有签名的 bug #383
- 修复无法正常加载 S3 存储桶列表时报错的 bug.
- 修复无法正常加载 S3 存储桶列表时旧的存储桶列表缓存未清空的 BUG
- 修复悬浮操作栏显示异常的 BUG #382
- 修复生成单文件直链时，仍然显示批量导出按钮的 BUG
- 修复直链下载日志表中 ip 字段长度不够存储 ipv6 的 问题

<div className={'divider'}></div>

## 4.0.2

### 新功能
- 全部部署方式均支持  IPV6
- 画廊模式下支持单击图片放大预览

### 优化
- 大幅优化文件列表加载性能
- 更换图片预览组件，优化打开图片预览的性能
- 重写画廊模式，大幅优化打开性能
- 移除无用依赖，减小项目体积
- 优化密码文件夹体验，不允许关闭密码输入框，未输入密码不允许任何操作

### BUG
- 修复文件名或路径名中包含 # 时报错的问题
- 修复鼠标未点击过 zfile 时, 拖拽上传失败的 bug
- 修复直链二维码宽度在不同浏览器下兼容性问题
- 修复 flv 格式会进行弹窗的 bug

<div className={'divider'}></div>

## 4.0.1

### 新功能
- 增加文件点击习惯设置, 支持设置为单击还是双击

### 优化
- 优化上传速度提示功能
- 优化下载日志体验, 增加跳转至第 N 页功能, 增加更多页码选项

### BUG 修复
- 统一下载日志 storage_key 字段长度, 防止存储源长度过长后无法正常记录下载日志.
- 存储源不存在时进行提示，修复后提示存储源不存在
- 修复管理员修改密码无效的 bug
- 修复目录文档某些情况无法匹配成功的 bug
- 修复 SharePoint 无法直链下载的 bug
- 修复 FLV 视频格式没有正常显示的 bug
- 修复移动端视频播放器无法正常使用的 BUG
- 修复当不允许文件操作时，右键通用操作按钮也没显示的 bug
- 修复隐藏直链未生效的 BUG

### 其他
- 修改错字, "登陆" 修改为 "登录"

<div className={'divider'}></div>

## 4.0.0

经过一个半月的开发, ZFile 升级为 4.0, 本次更新对代码进行了大量重构，优化了使用体验，增加更多功能支持，重磅支持文件操作功能，如上传、重命名、删除等操作.

### 新增功能

1. 支持文件操作：上传, 删除, 重命名, 新建文件夹. 后续还会支持移动和复制文件（详见下方**后续计划**）.
2. 操作系统级的文件操作体验
1. 支持拖拽上传和 Ctrl + V 粘贴上传文件和文件夹
2. 支持 Ctrl + A 全选文件, 按 Esc 取消全选.
3. 支持拖拽批量选择文件
4. 支持按住 Shift 多选文件
5. 支持多选文件后按 Delete 键删除文件.
6. 按 Backspace 返回上级文件夹.
3. 全新的 UI 风格, 更简洁易用.
4. 视频播放器支持播放上一个，下一个，选择当前目录下视频列表.
5. 视频播放器支持调用本地软件进行下载，如迅雷、Motrix. 支持调用本地播放器播放，更好的进行视频解码： PotPlayer， IINA, VLC, nPlayer, MXPlayer(Free/Pro)
6. 全新画廊模式, 支持按照瀑布流显示图片, 支持自定义 N 栏, 自定义每栏的间距
7. 全新目录文档配置方式，支持在后台使用在线编辑器撰写目录文档.
8. 全选密码文件夹设置方式, 支持按照通配符给文件夹设置密码
9. 全新过滤文件夹设置, 支持按照通配符过滤文件或文件夹, 同时控制仅隐藏、隐藏且目录不可见、隐藏且不可下载目录下的文件.
10. 后台登录支持设置验证码和 2FA 身份认证，防止后台被暴力破解
11. 支持自定义文件格式后缀, 避免系统内置的不完善导致文件无法预览.
12. 完美支持 MySQL 数据库, 同时默认使用 SQLite 数据库, 可根据自身需要选择.


### 捐赠版

为了项目的持续开发, 如您需要更高级的功能, 还可以选择捐赠版, 支持更多功能, 同步拥有社区版所有功能, 捐赠版按照域名永久授权, 新功能包括但不限于:

1. 本地存储、WebDav、FTP、SFTP、阿里云 OSS、腾讯云 COS 支持限制单链接速度, 有效降低服务器负载.
2. 本地存储支持控制是否允许多线程下载.
3. 上传、删除、重命名、新建文件夹等操作支持权限控制，控制每个功能*允许匿名使用**或*允许管理员登录后使用*
4. 直链下载统计，对直链的下载进行按文件下载次数、按下载来源（Referer），按下载 IP 排序，找出热点文件.
5. 文件搜索功能，支持全局模糊搜索文件.
6. 捐赠版交流群，大家交流经验，分享资源.
7. 第一时间体验新功能及更快的问题反馈和解答.
8. 持续更新...

### 后续开发计划


0. 全新文档和官网 (2022-07-30 前)
1. Google Drive 支持 (2022-07-30 前)
2. 夜间模式适配 (2022-07-30 前)
3. 支持显示文件树功能  (2022-07-30 前)
4. 支持设置文件夹可单击还是双击进入 (2022-07-30 前)
5. 文件预览等单独到一个页面显示，而不是现有弹窗 (2022-08-15 前)
6. 支持对外提供 WebDav 服务  (2022-08-15 前)
7. 负载均衡功能（捐赠版）(2022-08-15 前)

### 常见问题

1. 暂不支持从 3.x 版本数据迁移至 4.x 版本, 且前期版本可能会有些不稳定, 请做好备份.
2. 3.x 版本也会持续更新一些功能, 修复 BUG 和漏洞.


## 3.x

更早的版本请前往 Github 查看：

https://github.com/zfile-dev/zfile/releases